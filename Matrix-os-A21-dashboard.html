matrix-os A21 dashboard system
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Matrix – Analytics Dashboard (A21)</title>
<style>
  :root { --c:#00fff9; --bg1:#000; --bg2:#03131a; }
  body { margin:0; padding:18px; background:linear-gradient(135deg,var(--bg1),var(--bg2) 55%); color:var(--c); font-family:"Orbitron",system-ui,Arial,sans-serif; }
  header { text-align:center; font-size:1.6rem; text-shadow:0 0 16px var(--c); margin-bottom:12px; }
  .controls { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; align-items:center; margin: 6px 0 16px; }
  select, button { border:none; border-radius:10px; padding:8px 12px; font-weight:700; }
  button { background:var(--c); color:#000; cursor:pointer; }
  button:hover { filter:brightness(1.1); transform:scale(1.02); }
  .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
  .card { border:1px solid var(--c); border-radius:14px; padding:12px; background:rgba(0,0,0,.55); box-shadow:0 0 20px var(--c); }
  .title { margin:0 0 8px; font-size:1.05rem; text-shadow:0 0 8px var(--c); }
  canvas { width:100%; height:320px; }
  small { color:#aee; opacity:.9; }
</style>
</head>
<body>
  <header>Matrix Analytics Dashboard</header>

  <div class="controls">
    <label>Time window:
      <select id="hours">
        <option value="6">Last 6h</option>
        <option value="12">Last 12h</option>
        <option value="24" selected>Last 24h</option>
        <option value="72">Last 72h</option>
        <option value="168">Last 7 days</option>
      </select>
    </label>
    <label>Interval:
      <select id="interval">
        <option value="hour" selected>Hour</option>
        <option value="day">Day</option>
        <option value="minute">Minute</option>
      </select>
    </label>
    <button id="refreshBtn">Refresh</button>
    <button id="autoBtn">Auto (10s)</button>
    <small id="ts">Last update: —</small>
  </div>

  <div class="grid">
    <div class="card">
      <p class="title">Top Users</p>
      <canvas id="chartUsers"></canvas>
    </div>
    <div class="card">
      <p class="title">Top AI Events</p>
      <canvas id="chartEvents"></canvas>
    </div>
    <div class="card">
      <p class="title">Session Summary</p>
      <canvas id="chartSessions"></canvas>
    </div>
    <div class="card">
      <p class="title">Activity Timeline (AI vs Sessions)</p>
      <canvas id="chartActivity"></canvas>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
  // === CONFIG ===
  const BRIDGE = "http://127.0.0.1:5067"; // matrix-OS-A21-analytics-bridge.py
  const SUMMARY = BRIDGE + "/api/charts/summary";
  const ACTIVITY = BRIDGE + "/api/charts/activity"; // accepts ?hours= & interval=
  const fmt = (obj) => (typeof obj==="string"? obj : JSON.stringify(obj,null,2));

  let autoTimer = null;
  let charts = {};

  function nowTS(){ return new Date().toLocaleTimeString(); }
  function setTS(){ document.getElementById("ts").textContent = "Last update: " + nowTS(); }

  function ensureChart(key, ctx, type, data, options){
    if (charts[key]) { charts[key].data = data; charts[key].options = options || charts[key].options; charts[key].update(); return charts[key]; }
    charts[key] = new Chart(ctx, { type, data, options });
    return charts[key];
  }

  function datasetDefaults(ds){
    // Provide minimal styling while letting Chart.js pick sensible defaults
    return ds.map(d => ({ ...d, borderWidth: 2, tension: 0.3 }));
  }

  async function fetchJSON(url){
    const r = await fetch(url);
    return await r.json();
  }

  async function loadAll(){
    const hrs = document.getElementById("hours").value;
    const interval = document.getElementById("interval").value;

    // Grab bundle (top users, events, session summary) in one call
    let bundle;
    try {
      bundle = await fetchJSON(SUMMARY);
    } catch(e) {
      console.error("Summary fetch error:", e);
      return;
    }
    if (!bundle.ok) { console.error("Summary error:", bundle.error); return; }
    const topUsers = bundle.data.top_users || {labels:[], datasets:[{label:"Top Users", data:[]}]};
    const topEvents = bundle.data.top_events || {labels:[], datasets:[{label:"Top AI Events", data:[]}]};
    const sess = bundle.data.session_summary || {labels:[], datasets:[{label:"Sessions", data:[]}]};

    // Activity uses requested window/interval
    let activity;
    try {
      activity = await fetchJSON(`${ACTIVITY}?hours=${encodeURIComponent(hrs)}&interval=${encodeURIComponent(interval)}`);
    } catch(e) {
      console.error("Activity fetch error:", e);
      return;
    }
    if (!activity.ok) { console.error("Activity error:", activity.error); return; }
    const act = activity.data || {labels:[], datasets:[]};

    // Build charts
    const usersCtx = document.getElementById("chartUsers");
    ensureChart(
      "users",
      usersCtx,
      "bar",
      { labels: topUsers.labels || [], datasets: datasetDefaults(topUsers.datasets || []) },
      { responsive:true, plugins:{ legend:{ display:false }}, scales:{ y:{ beginAtZero:true } } }
    );

    const eventsCtx = document.getElementById("chartEvents");
    ensureChart(
      "events",
      eventsCtx,
      "bar",
      { labels: topEvents.labels || [], datasets: datasetDefaults(topEvents.datasets || []) },
      { responsive:true, plugins:{ legend:{ display:false }}, scales:{ y:{ beginAtZero:true } } }
    );

    const sessionsCtx = document.getElementById("chartSessions");
    ensureChart(
      "sessions",
      sessionsCtx,
      "doughnut",
      { labels: sess.labels || [], datasets: datasetDefaults(sess.datasets || []) },
      { responsive:true, plugins:{ legend:{ position:"bottom" } } }
    );

    const activityCtx = document.getElementById("chartActivity");
    ensureChart(
      "activity",
      activityCtx,
      "line",
      { labels: act.labels || [], datasets: datasetDefaults(act.datasets || []) },
      { responsive:true, plugins:{ legend:{ position:"bottom" }}, scales:{ y:{ beginAtZero:true } } }
    );

    setTS();
  }

  // Wire controls
  document.getElementById("refreshBtn").addEventListener("click", loadAll);
  document.getElementById("autoBtn").addEventListener("click", () => {
    if (autoTimer) {
      clearInterval(autoTimer); autoTimer = null;
      document.getElementById("autoBtn").textContent = "Auto (10s)";
      return;
    }
    loadAll();
    autoTimer = setInterval(loadAll, 10000);
    document.getElementById("autoBtn").textContent = "Stop Auto";
  });

  // Initial load
  loadAll();
  </script>

  <!-- Protect the page: require Developer (Level 3) -->
  <script src="matrix-OS-A14-guard.js" data-min-level="3"></script>
</body>
</html>
